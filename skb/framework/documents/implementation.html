<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<meta name="author" content="Sven van der Meer">
<title>The Implementation</title>
<style>
@import url(http://red-hat-overpass-fonts.s3.amazonaws.com/overpass.css);
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
@import url(https://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.css);
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: #e5e5e5; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.spread { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.15625em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #4d4d4d; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #006699; text-decoration: none; line-height: inherit; }
a:hover, a:focus { color: #ea0011; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: "Helvetica Neue", Helvetica, "Liberation Sans", Arial, sans-serif; font-weight: normal; font-size: 0.9375em; line-height: 1.4; margin-bottom: 1.375em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Overpass, "Helvetica Neue", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; color: black; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #4d4d4d; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Menlo, Monaco, "Liberation Mono", Consolas, monospace; font-weight: normal; color: #3b3b3b; }

/* Lists */
ul, ol, dl { font-size: 0.9375em; line-height: 1.4; margin-bottom: 1.375em; list-style-position: outside; font-family: "Helvetica Neue", Helvetica, "Liberation Sans", Arial, sans-serif; }

ul, ol { margin-left: 1.625em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.625em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3em; font-weight: bold; }
dl dd { margin-bottom: 0.75em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #404040; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.375em; padding: 0 0 0 1em; border-left: 5px solid #ededed; }
blockquote cite { display: block; font-size: 0.8125em; color: #333333; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #333333; }

blockquote, blockquote p { line-height: 1.4; color: #404040; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

body { -moz-osx-font-smoothing: grayscale; -webkit-font-smoothing: antialiased; tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }

a:hover, a:focus { text-decoration: underline; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.9375em; font-style: normal !important; letter-spacing: 0; padding: 1px 4px; background-color: #eff1f1; border: 1px solid #d4d9d9; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; word-wrap: break-word; }
*:not(pre) > code.nobreak { word-wrap: normal; }
*:not(pre) > code.nowrap { white-space: nowrap; }

pre, pre > code { line-height: 1.6; color: #3b3b3b; font-family: Menlo, Monaco, "Liberation Mono", Consolas, monospace; font-weight: normal; }

em em { font-style: normal; }

strong strong { font-weight: normal; }

.keyseq { color: #737373; }

kbd { font-family: Menlo, Monaco, "Liberation Mono", Consolas, monospace; display: inline-block; color: #404040; font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menuref { color: #000; }

.menuseq b:not(.caret), .menuref { font-weight: inherit; }

.menuseq { word-spacing: -0.02em; }
.menuseq b.caret { font-size: 1.25em; line-height: 0.8; }
.menuseq i.caret { font-weight: bold; text-align: center; width: 0.45em; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: black; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #333333; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #404040; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #404040; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 0 solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: Overpass, "Helvetica Neue", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #4d4d4d; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #e5e5e5; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #cccccc; margin-bottom: 1.25em; padding: 1.25em; background: #e5e5e5; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: white; padding: 1.25em; }

#footer-text { color: #666666; line-height: 1.26; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 0 solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: black; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: black; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: black; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: initial; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: Overpass, "Helvetica Neue", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #333333; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #cccccc; margin-bottom: 1.25em; padding: 1.25em; background: #e5e5e5; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #cccccc; margin-bottom: 1.25em; padding: 1.25em; background: #e5e5e5; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #4d4d4d; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eff1f1; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 0 0 0 2px solid rgba(120, 120, 120, 0.35); -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 1em 1.5em 0.875em 1.5em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eff1f1; background-color: #3b3b3b; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 1em 1.5em 0.875em 1.5em; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.6; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.375em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #404040; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #4d4d4d; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #333333; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.375em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #404040; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: #333333; }

.quoteblock.abstract { margin: 0 0 1.375em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock { border-width: 0 1px 1px 0; }

table.grid-all > tfoot > tr > .tableblock { border-width: 1px 1px 0 0; }

table.grid-cols > * > tr > .tableblock { border-width: 0 1px 0 0; }

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock { border-width: 0 0 1px 0; }

table.grid-rows > tfoot > tr > .tableblock { border-width: 1px 0 0 0; }

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock { border-bottom-width: 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.875em; }

ul li ol { margin-left: 1.625em; }

dl dd { margin-left: 2em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.6875em; }

ul.checklist, ul.none, ol.none, ul.no-bullet, ol.no-bullet, ol.unnumbered, ul.unstyled, ol.unstyled { list-style-type: none; }

ul.no-bullet, ol.no-bullet, ol.unnumbered { margin-left: 0.625em; }

ul.unstyled, ol.unstyled { margin-left: 0; }

ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1.25em; font-size: 0.8em; position: relative; bottom: 0.125em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.inline { margin: 0 auto 0.6875em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 1.375em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0.4em 0.75em 0 0.75em; line-height: 1; vertical-align: top; }
.colist > table tr > td:first-of-type img { max-width: initial; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.05em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }
a span.icon > .fa { cursor: inherit; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #004c73; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #404040; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

#header, #content, #footnotes { background: white; padding-left: 2.5em; padding-right: 2.5em; }

#header { margin-bottom: 0; }
#header > h1 { border-bottom: none; }

.literalblock pre, .listingblock pre { background: #eff1f1; }

#footnotes { margin-bottom: 2em; }

.sect1 { padding-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .olist, .olist .ulist { margin-bottom: 0.34375em; }

</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>The Implementation</h1>
<div class="details">
<span id="author" class="author">Sven van der Meer</span><br>
<span id="email" class="email"><a href="mailto:vdmeer.sven@mykolab.com">vdmeer.sven@mykolab.com</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_skb_framework">1. skb-framework</a></li>
<li><a href="#_the_loader">2. The Loader</a>
<ul class="sectlevel2">
<li><a href="#_dependencies">2.1. Dependencies</a></li>
<li><a href="#_core_and_default_settings">2.2. Core and default Settings</a></li>
<li><a href="#_core_includes">2.3. Core Includes</a></li>
<li><a href="#_application_flavor_and_name">2.4. Application Flavor and Name</a></li>
<li><a href="#_temporary_directory">2.5. Temporary Directory</a></li>
<li><a href="#_sneak_preview_of_cli_arguments">2.6. Sneak Preview of CLI Arguments</a></li>
<li><a href="#_parameter_declarations">2.7. Parameter Declarations</a></li>
<li><a href="#_option_declarations">2.8. Option Declarations</a></li>
<li><a href="#_parse_command_line_arguments">2.9. Parse Command Line Arguments</a></li>
<li><a href="#_realize_early_exit_options">2.10. Realize early Exit Options</a></li>
<li><a href="#_declarations_for_commands_and_exit_status_codes">2.11. Declarations for Commands and Exit Status Codes</a></li>
<li><a href="#_dependency_declarations">2.12. Dependency Declarations</a></li>
<li><a href="#_task_declarations">2.13. Task Declarations</a></li>
<li><a href="#_scenario_declarations">2.14. Scenario Declarations</a></li>
<li><a href="#_set_levels">2.15. Set Levels</a></li>
<li><a href="#_do_exit_options">2.16. Do (Exit) Options</a></li>
<li><a href="#_create_runtime_configuration_file">2.17. Create Runtime Configuration File</a></li>
<li><a href="#_execute_task_or_scenario">2.18. Execute Task or Scenario</a></li>
<li><a href="#_start_shell">2.19. Start Shell</a></li>
<li><a href="#_clean_up">2.20. Clean Up</a></li>
<li><a href="#_done">2.21. Done</a></li>
</ul>
</li>
<li><a href="#_the_shell">3. The Shell</a>
<ul class="sectlevel2">
<li><a href="#_test_parent_and_and_load_configuration">3.1. Test Parent and and load Configuration</a></li>
<li><a href="#_include">3.2. Include</a></li>
<li><a href="#_settings">3.3. Settings</a></li>
<li><a href="#_inner_loop_fwinterpreter">3.4. Inner Loop: FWInterpreter</a>
<ul class="sectlevel3">
<li><a href="#_execute_a_scenario">3.4.1. Execute a Scenario</a></li>
<li><a href="#_clear_screen">3.4.2. Clear Screen</a></li>
<li><a href="#_time">3.4.3. Time</a></li>
<li><a href="#_print_configuration">3.4.4. Print Configuration</a></li>
<li><a href="#_print_statistics">3.4.5. Print Statistics</a></li>
<li><a href="#_list_tasks">3.4.6. List Tasks</a></li>
<li><a href="#_list_application_tasks">3.4.7. List Application Tasks</a></li>
<li><a href="#_comments">3.4.8. Comments</a></li>
<li><a href="#_all_other_input">3.4.9. All other Input</a></li>
</ul>
</li>
<li><a href="#_outer_loop_fwshell">3.5. Outer Loop: FWShell</a>
<ul class="sectlevel3">
<li><a href="#_help">3.5.1. Help</a></li>
<li><a href="#_history">3.5.2. History</a></li>
<li><a href="#_exit">3.5.3. Exit</a></li>
<li><a href="#_all_other_input_2">3.5.4. All other Input</a></li>
</ul>
</li>
<li><a href="#_run_the_shell">3.6. Run the Shell</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>for SKB-Framework v0.0.3, May 09, 2019</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_skb_framework">1. skb-framework</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>skb-framework</code> is the main entry point to the framework.
It realizes two things in one.
First, it is an application itself.
Second, it is a start script that can be used by other applications to start the framework.</p>
</div>
<div class="paragraph">
<p>At the start, it checks the setting <code>__FW_LOADER_FLAVOR</code> (line 1 in the source block below).
If this variable is set, then another application wants to start the framework.
Otherwise, the <code>skb-framework</code> is the application.
In the later case, the script sets required variables for the loader (lines 3-5 below):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>__FW_LOADER_FLAVOR</code> - the flavor of the application, here <code>SF</code></p>
</li>
<li>
<p><code>__FW_LOADER_SCRIPTNAME</code> - the name of the script (application)</p>
</li>
<li>
<p><code>__FW_LOADER_APPNAME</code> - the application name</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The next step is to find the framework installation.
The script tries the variable <code>SF_HOME</code> first, <code>readlink</code> first (lines 8-13), if that fails <code>dirname</code> (lines 15-19).
If all attempts fail, the script terminates with an error (lines 20-24).
Otherwise it set <code>FW_HOME</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td>
  <td class="code"><pre>if [[ -z ${__FW_LOADER_FLAVOR:-} ]]; then
    ## we should load the framework itself, so SF
    export __FW_LOADER_FLAVOR=&quot;SF&quot;
    export __FW_LOADER_SCRIPTNAME=&quot;$0&quot;
    export __FW_LOADER_APPNAME=&quot;SKB Framework&quot;

    ## try readline to find where we are
    if [[ -z ${SF_HOME:-} ]]; then
        SF_HOME=$(readlink -f $0)
        SF_HOME=${SF_HOME%/*}
        SF_HOME=${SF_HOME%/*}
        export SF_HOME
    fi
    ## try dirname to find where we are
    if [[ -z ${SF_HOME:-} ]]; then
        SF_HOME=$(dirname $0)
        SF_HOME=$(cd $SF_HOME/..; pwd)
        export SF_HOME
    fi
    if [[ -z ${SF_HOME:-} ]]; then
        printf &quot;  unable to set home \$SF_HOME (tried environment, readlink, and dirname \$0)\n&quot;
        printf &quot;  please set SF_HOME\n\n&quot;
        exit 10
    fi
    export FW_HOME=$SF_HOME</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>skb-framework</code> is used by another application to start the framework, the script only tries to find the framework installation.
The mechanism here is the same as explained above: try <code>FW_HOME</code> first, then <code>readlink</code>, then <code>dirname</code>.
IF all fails, exit with an error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td>
  <td class="code"><pre>else
    ## try readline to find where we are
    if [[ -z ${FW_HOME:-} ]]; then
        FW_HOME=$(readlink -f $0)
        FW_HOME=${FW_HOME%/*}
        FW_HOME=${FW_HOME%/*}
        export FW_HOME
    fi
    ## try dirname to find where we are
    if [[ -z ${FW_HOME:-} ]]; then
        FW_HOME=$(dirname $0)
        FW_HOME=$(cd $FW_HOME/..; pwd)
        export FW_HOME
    fi
    if [[ -z ${FW_HOME:-} ]]; then
        printf &quot;  unable to set framework home \$FW_HOME (tried environment, readlink, and dirname \$0)\n&quot;
        printf &quot;  please set FW_HOME\n\n&quot;
        exit 10
    fi</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>One the framework installation has been found, the script tests if the loader exists.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre>if [[ ! -x $FW_HOME/bin/loader/loader.sh ]]; then
    printf &quot;  did find/set \$FW_HOME, but did not find loader\n&quot;
    printf &quot;  tried $FW_HOME/bin/loader/loader.sh\n\n&quot;
    exit 11
fi</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>When all conditions are satisfied, the script executes the loader handing over all arguments unprocessed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
</pre></td>
  <td class="code"><pre>$FW_HOME/bin/loader/loader.sh $*
exit $?</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_loader">2. The Loader</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The loader is the script <code>$FW_HOME/bin/loader/loader.sh</code>.
It is responsible for all initial configuration, loading elements, testing settings and dependencies, processing command line arguments (options), and execute task, scenarios, or the shell.
The load process has multiple steps, starting with some initial settings and finished with a cleanup.</p>
</div>
<div class="paragraph">
<p>The initial settings are shown in the source block below.
Line 1 restricts <em>bash</em>, providing a safer execution environment.
Line 2 allows for extended globbing (finding files recursively with wildecards such as <code><strong>*/</strong>.adoc</code>).
Line 3 takes the current time.
This information is later used to calculate how long the load process did take.
Line 4 removes an environment setting that prints rather annoying messages when running Java.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>set -o errexit -o pipefail -o noclobber -o nounset
shopt -s globstar
_ts=$(date +%s.%N)
unset JAVA_TOOL_OPTIONS</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_dependencies">2.1. Dependencies</h3>
<div class="paragraph">
<p>The first real action in the load process is the test for core dependencies.
The source block below shows how the loader tests for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>BASH</em> version 4 - needed to use associative arrays (or maps)</p>
</li>
<li>
<p>GNU <em>Getopt</em> - extensively used in the loader and tasks to parse command lines</p>
</li>
<li>
<p><em>bc</em> - a calculator used for calculating execution time of tasks and scenarios</p>
</li>
<li>
<p><em>mktemp</em> - used to create names for temporary directories, required to store runtime configuration information</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td>
  <td class="code"><pre>if [[ &quot;${BASH_VERSION:0:1}&quot; -lt 4 ]]; then
    printf &quot; ==&gt; no bash version &gt;4, required for associative arrays\n\n&quot;
    exit 12
fi
! getopt --test &gt; /dev/null
if [[ ${PIPESTATUS[0]} -ne 4 ]]; then
    printf &quot; ==&gt; getopt failed, require for command line parsing\n\n&quot;
    exit 13
fi
if [[ ! $(command -v bc) ]]; then
    printf &quot; ==&gt; did not find bc, require for calculations\n\n&quot;
    exit 14
fi
if [[ ! $(command -v mktemp) ]]; then
    printf &quot; ==&gt; did not find mktemp, require to create temporary files and directories\n\n&quot;
    exit 15
fi</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_core_and_default_settings">2.2. Core and default Settings</h3>
<div class="paragraph">
<p>Once all dependencies are satisfied, the loader realizes core settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If not set, then set <code>$FW_HOME</code> (lines 1-4)</p>
</li>
<li>
<p>Source the loaders declaration files (line 6).
This will create the main configuration map called <code>CONFIG_MAP</code> along with the map <code>CONFIG_SRC</code>.</p>
</li>
<li>
<p>Set core variables in the configuration map (lines 7-25):</p>
<div class="ulist">
<ul>
<li>
<p><em>FW_HOME</em> - the home directory of the framework</p>
</li>
<li>
<p><em>RUNNING_IN</em> - set to loader, this will later be changed the <code>shell</code> or <code>task</code> by the shell and tasks</p>
</li>
<li>
<p><em>SYSTEM</em> - to know in which system the framework is running</p>
</li>
<li>
<p><em>CONFIG_FILE</em> - the SKB configuration file</p>
</li>
<li>
<p><em>STRICT</em> - set strict mode to <code>off</code>, at least initially</p>
</li>
<li>
<p><em>APP_MODE</em> - set the default application mode to <code>use</code></p>
</li>
<li>
<p><em>APP_MODE_FLAVOR</em> - set the default flavor of the application mode to <code>std</code> (standard)</p>
</li>
<li>
<p><em>PRINT_MODE</em> - set the default print mode to <code>ansi</code> (for ANSI formatted text with colors and effects)</p>
</li>
<li>
<p>Levels - set the levels for loader, shell, and tasks initially to <code>error</code></p>
</li>
<li>
<p>Quiet - set quiet mode for loader, shell, and tasks to <code>off</code>, i.e. they are <em>not</em> quiet</p>
</li>
<li>
<p><em>SCENARIO_PATH</em> - create an empty path for scenarios</p>
</li>
<li>
<p><em>SHELL_SNP</em> - activate shell prompt</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td>
  <td class="code"><pre>if [[ -z ${FW_HOME:-} ]]; then
    FW_HOME=$(dirname $0)
    FW_HOME=$(cd $FW_HOME/../.. &amp;&amp; pwd)
fi

source $FW_HOME/bin/loader/declare/_include
CONFIG_MAP[&quot;FW_HOME&quot;]=$FW_HOME                      # home of the framework
export FW_HOME
CONFIG_MAP[&quot;RUNNING_IN&quot;]=&quot;loader&quot;                   # we are in the loader, shell/tasks will change this to &quot;shell&quot; or &quot;task&quot;
CONFIG_MAP[&quot;SYSTEM&quot;]=$(uname -s | cut -c1-6)        # set system, e.g. for Cygwin path conversions
CONFIG_MAP[&quot;CONFIG_FILE&quot;]=&quot;$HOME/.skb&quot;              # config file, in user's home directory
CONFIG_MAP[&quot;STRICT&quot;]=off                            # not strict, yet (change with --strict)
CONFIG_MAP[&quot;APP_MODE&quot;]=use                          # default application mode is use, change with --all-mode, --build-mode, --dev-mode
CONFIG_MAP[&quot;APP_MODE_FLAVOR&quot;]=std                   # default application mode flavor is std, change with --install
CONFIG_MAP[&quot;PRINT_MODE&quot;]=ansi                       # default print mode is ansi, change with --print-mode

CONFIG_MAP[&quot;LOADER_LEVEL&quot;]=&quot;error&quot;                  # output level for loader, change with --loader-level, set to &quot;debug&quot; for early code debugging
CONFIG_MAP[&quot;SHELL_LEVEL&quot;]=&quot;error&quot;                   # output level for shell, change with --shell-level
CONFIG_MAP[&quot;TASK_LEVEL&quot;]=&quot;error&quot;                    # output level for tasks, change with --task-level

CONFIG_MAP[&quot;LOADER_QUIET&quot;]=&quot;off&quot;                    # message level for loader, change with --lq
CONFIG_MAP[&quot;SHELL_QUIET&quot;]=&quot;off&quot;                     # message level for shell, change with --sq
CONFIG_MAP[&quot;TASK_QUIET&quot;]=&quot;off&quot;                      # message level for tasks, change with --tq

CONFIG_MAP[&quot;SCENARIO_PATH&quot;]=&quot;&quot;                      # empty scenario path, set from ENV or file (parameter)
CONFIG_MAP[&quot;SHELL_SNP&quot;]=&quot;off&quot;                       # shell shows prompt, change with --snp</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_core_includes">2.3. Core Includes</h3>
<div class="paragraph">
<p>Next, some core files from the framework&#8217;s API are loaded.
To makes things simple, the provided <code><em>include</code> files are used to load all API functions.
Error and warning counters are reset, i.e. set to _0</em>.
Finally, the loaders own function for parsing the command line is loaded (line 6).
This only loads the function, it does not actually parse the command line.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
</pre></td>
  <td class="code"><pre>source $FW_HOME/bin/api/_include
ConsoleResetErrors
ConsoleResetWarnings

source $FW_HOME/bin/api/describe/_include
source $FW_HOME/bin/loader/init/parse-cli.sh</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_application_flavor_and_name">2.4. Application Flavor and Name</h3>
<div class="paragraph">
<p>The next step is to set the flavor and application name/script.
The flavor is any prefix used by the application to identify parameters.
It must be provided by the application (which starts the loader) as the setting <code>__FW_LOADER_FLAVOR</code>.
Once flavor and application settings are realized, the application map and version are loaded (lines 44-51).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre></td>
  <td class="code"><pre>if [[ -z ${__FW_LOADER_FLAVOR:-} ]]; then
    ConsoleFatal &quot; -&gt;&quot; &quot;interal error: no flavor set&quot;
    printf &quot;\n&quot;
    exit 16
else
    CONFIG_MAP[&quot;FLAVOR&quot;]=$__FW_LOADER_FLAVOR
    CONFIG_SRC[&quot;FLAVOR&quot;]=&quot;E&quot;
    if [[ -z ${CONFIG_MAP[&quot;FLAVOR&quot;]} ]]; then
        ## did not find FLAVOR
        ConsoleFatal &quot; -&gt;&quot; &quot;internal error: did not find setting for flavor&quot;
        printf &quot;\n&quot;
        exit 16
    fi

    FLAVOR_HOME=&quot;${CONFIG_MAP[&quot;FLAVOR&quot;]}_HOME&quot;
    CONFIG_MAP[&quot;APP_HOME&quot;]=${!FLAVOR_HOME:-}
    CONFIG_SRC[&quot;APP_HOME&quot;]=&quot;E&quot;
    if [[ -z ${CONFIG_MAP[&quot;APP_HOME&quot;]:-} ]]; then
        ConsoleFatal &quot; -&gt;&quot; &quot;did not find environment setting for application home, tried \$${CONFIG_MAP[&quot;FLAVOR&quot;]}_HOME&quot;
        printf &quot;\n&quot;
        exit 17
    elif [[ ! -d ${CONFIG_MAP[&quot;APP_HOME&quot;]} ]]; then
        ## found home, but is no directory
        ConsoleFatal &quot; -&gt;&quot; &quot;\$${CONFIG_MAP[&quot;FLAVOR&quot;]}_HOME set as ${CONFIG_MAP[&quot;APP_HOME&quot;]} does not point to a directory&quot;
        printf &quot;\n&quot;
        exit 18
    fi
fi

if [[ -z ${__FW_LOADER_SCRIPTNAME:-} ]]; then
    ConsoleFatal &quot; -&gt;&quot; &quot;interal error: no application script name set&quot;
    printf &quot;\n&quot;
    exit 20
else
    CONFIG_MAP[&quot;APP_SCRIPT&quot;]=${__FW_LOADER_SCRIPTNAME##*/}
fi
if [[ -z &quot;${__FW_LOADER_APPNAME:-}&quot; ]]; then
    ConsoleFatal &quot; -&gt;&quot; &quot;interal error: no application name set&quot;
    printf &quot;\n&quot;
    exit 21
else
    CONFIG_MAP[&quot;APP_NAME&quot;]=$__FW_LOADER_APPNAME
fi
source $FW_HOME/bin/loader/declare/app-maps.sh
if [[ -f ${CONFIG_MAP[&quot;APP_HOME&quot;]}/etc/version.txt ]]; then
    CONFIG_MAP[&quot;APP_VERSION&quot;]=$(cat ${CONFIG_MAP[&quot;APP_HOME&quot;]}/etc/version.txt)
else
    ConsoleFatal &quot; -&gt;&quot; &quot;no application version found, tried \$APP_HOME/etc/version.txt&quot;
    printf &quot;\n&quot;
    exit 22
fi
if [[ -f ${CONFIG_MAP[&quot;FW_HOME&quot;]}/etc/version.txt ]]; then
    CONFIG_MAP[&quot;FW_VERSION&quot;]=$(cat ${CONFIG_MAP[&quot;FW_HOME&quot;]}/etc/version.txt)
else
    ConsoleFatal &quot; -&gt;&quot; &quot;no framework version found, tried \$FW_HOME/etc/version.txt&quot;
    printf &quot;\n&quot;
    exit 22
fi</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_temporary_directory">2.5. Temporary Directory</h3>
<div class="paragraph">
<p>The next step is to test if the temporary directory can be created.
This is important for two reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The directory uses the application flavor in the same, to separate several SKB applications that might be running on the same host</p>
</li>
<li>
<p>In the directory, the loader will safe to runtime configuration.
This is required because associative arrays (or hash maps, or maps), used to store all configuration data, cannot be exported into the <em>bash</em> environment.
Using temporary files is the only way for the loader to share the configuration with the shell, and for the shell to share it with tasks.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td>
  <td class="code"><pre>if [[ ! -z ${TMP:-} ]]; then
    TMP_DIRECTORY=${TMP}/${CONFIG_MAP[&quot;APP_SCRIPT&quot;]}
else
    TMP_DIRECTORY=${TMPDIR:-/tmp}/${CONFIG_MAP[&quot;APP_SCRIPT&quot;]}
fi
if [[ ! -d $TMP_DIRECTORY ]]; then
    mkdir $TMP_DIRECTORY 2&gt; /dev/null
    __errno=$?
    if [[ $__errno != 0 ]]; then
        ConsoleFatal &quot; -&gt;&quot; &quot;could not create temporary directory $TMP_DIRECTORY, please check owner and permissions&quot;
        printf &quot;\n&quot;
        exit 23
    fi
fi
if [[ ! -w $TMP_DIRECTORY ]]; then
    ConsoleFatal &quot; -&gt;&quot; &quot;cannot write to temporary directory $TMP_DIRECTORY, please check owner and permissions&quot;
    printf &quot;\n&quot;
    exit 24
fi</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sneak_preview_of_cli_arguments">2.6. Sneak Preview of CLI Arguments</h3>
<div class="paragraph">
<p>Next, the loader does a sneak preview inside the command line arguments.
This is done to determine the application mode that might be requested from the command line.
We need to know the requested mode here, before we actually do parse the arguments later.
This is important to load the correct declarations for all elements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td>
  <td class="code"><pre>case &quot;$@&quot; in
    *&quot;-D&quot;* | *&quot;--dev-mode&quot;*)
        CONFIG_MAP[&quot;APP_MODE&quot;]=&quot;dev&quot;
        CONFIG_SRC[&quot;APP_MODE&quot;]=&quot;O&quot;
        ;;
    *&quot;-B&quot;* | *&quot;--build-mode&quot;*)
        CONFIG_MAP[&quot;APP_MODE&quot;]=&quot;build&quot;
        CONFIG_SRC[&quot;APP_MODE&quot;]=&quot;O&quot;
        ;;
    *&quot;-A&quot;* | *&quot;--all-mode&quot;*)
        CONFIG_MAP[&quot;APP_MODE&quot;]=&quot;all&quot;
        CONFIG_SRC[&quot;APP_MODE&quot;]=&quot;O&quot;
        ;;
esac</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_parameter_declarations">2.7. Parameter Declarations</h3>
<div class="paragraph">
<p>With the application mode set, the loader can load the parameter declarations.
These declarations can only be loaded from source, i.e. not from an optional cache, since one of the parameters actually sets the cache directory.
Once loaded (line 1), all loaded parameters are processed (line 4).
This function will load values from the environment, then from an optional configuration file, and finally from potentially declared default values.
This function only loads settings, it does not test any of these settings.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>DeclareParameters
if ConsoleHasErrors; then printf &quot;\n&quot;; exit 25; fi
source $FW_HOME/bin/loader/init/process-settings.sh
ProcessSettings</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_option_declarations">2.8. Option Declarations</h3>
<div class="paragraph">
<p>Next is the declaration of command line options.
This declaration can be done from cache (if cached) or source (if no cache exists).
Errors here indicate bugs or runtime problems.
Once declared, all options are set to <code>false</code> in the CLI map (lines 8-11).
This allows to test which options have been used as actual arguments when parsing the command line later.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td>
  <td class="code"><pre>if [[ -f ${CONFIG_MAP[&quot;CACHE_DIR&quot;]}/opt-decl.map ]]; then
    ConsoleInfo &quot;--&gt;&quot; &quot;declaring options from cache&quot;
    source ${CONFIG_MAP[&quot;CACHE_DIR&quot;]}/opt-decl.map
else
    DeclareOptions
    if ConsoleHasErrors; then printf &quot;\n&quot;; exit 26; fi
fi
declare -A OPT_CLI_MAP
for ID in ${!DMAP_OPT_ORIGIN[@]}; do
    OPT_CLI_MAP[$ID]=false
done</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_parse_command_line_arguments">2.9. Parse Command Line Arguments</h3>
<div class="paragraph">
<p>Now the loader can safely parse the command line arguments.
The parse function does parse for most options, only set options that have no further side effect.
This means that this function does not execute on any option.
This is done later in the load process.
The print mode is immediately set and tested (lines 3-12) to make sure we have a valid setting for it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td>
  <td class="code"><pre>ParseCli $@
if ConsoleHasErrors; then printf &quot;\n&quot;; exit 27; fi
case &quot;${CONFIG_MAP[&quot;PRINT_MODE&quot;]:-}&quot; in
    ansi | text | adoc)
        ConsoleInfo &quot;--&gt;&quot; &quot;found print mode '${CONFIG_MAP[&quot;PRINT_MODE&quot;]}'&quot;
        ;;
    *)
        CONFIG_MAP[&quot;PRINT_MODE&quot;]=ansi
        CONFIG_SRC[&quot;PRINT_MODE&quot;]=
        ConsoleWarn &quot;--&gt;&quot; &quot;unknown print mode '${CONFIG_MAP[&quot;PRINT_MODE&quot;]}', assuming 'ansi'&quot;
        ;;
esac</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_realize_early_exit_options">2.10. Realize early Exit Options</h3>
<div class="paragraph">
<p>At this stage, the loader can realize early exit options.
Those are options that do not require any further actions by the loader.
These options include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clean the cache (lines 1-5),</p>
</li>
<li>
<p>Print the help screen (lines 6-9), and</p>
</li>
<li>
<p>Print the application version (lines 10-13)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If any of these options was requested, the loader will exit with code <em>0</em>, success.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>if [[ ${OPT_CLI_MAP[&quot;clean-cache&quot;]} != false ]]; then
    ConsoleInfo &quot;--&gt;&quot; &quot;cleaning cache and exit&quot;
    source ${CONFIG_MAP[&quot;FW_HOME&quot;]}/bin/loader/options/clean-cache.sh
    exit 0
fi
if [[ ${OPT_CLI_MAP[&quot;help&quot;]} != false ]]; then
    source ${CONFIG_MAP[&quot;FW_HOME&quot;]}/bin/loader/options/help.sh
    exit 0
fi
if [[ ${OPT_CLI_MAP[&quot;version&quot;]} != false ]]; then
    source ${CONFIG_MAP[&quot;FW_HOME&quot;]}/bin/loader/options/version.sh
    exit 0
fi</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_declarations_for_commands_and_exit_status_codes">2.11. Declarations for Commands and Exit Status Codes</h3>
<div class="paragraph">
<p>Now the declarations of shell commands (lines 1-7) and exit codes (lines 8-14) can be loaded, either from cache or source.
Errors here indicate a framework bug or runtime problem, since commands and exit codes are core features and rather static.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td>
  <td class="code"><pre>if [[ -f ${CONFIG_MAP[&quot;CACHE_DIR&quot;]}/cmd-decl.map ]]; then
    ConsoleInfo &quot;--&gt;&quot; &quot;declaring commands from cache&quot;
    source ${CONFIG_MAP[&quot;CACHE_DIR&quot;]}/cmd-decl.map
else
    DeclareCommands
    if ConsoleHasErrors; then printf &quot;\n&quot;; exit 28; fi
fi
if [[ -f ${CONFIG_MAP[&quot;CACHE_DIR&quot;]}/es-decl.map ]]; then
    ConsoleInfo &quot;--&gt;&quot; &quot;declaring exit-status from cache&quot;
    source ${CONFIG_MAP[&quot;CACHE_DIR&quot;]}/es-decl.map
else
    DeclareExitStatus
    if ConsoleHasErrors; then printf &quot;\n&quot;; exit 29; fi
fi</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dependency_declarations">2.12. Dependency Declarations</h3>
<div class="paragraph">
<p>The next step is to load dependency declarations, either from cache or from source.
Errors here can point to a bug in the framework, a problem in the application, or a problem with a dependency declaration itself.
In this step, dependencies are only declared, but not tested, since the loader still does not know which of them are required by tasks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
</pre></td>
  <td class="code"><pre>if [[ -f ${CONFIG_MAP[&quot;CACHE_DIR&quot;]}/dep-decl.map ]]; then
    ConsoleInfo &quot;--&gt;&quot; &quot;declaring dependencies from cache&quot;
    source ${CONFIG_MAP[&quot;CACHE_DIR&quot;]}/dep-decl.map
else
    ConsoleInfo &quot;--&gt;&quot; &quot;declaring dependencies from source&quot;
    DeclareDependencies
    if ConsoleHasErrors; then printf &quot;\n&quot;; exit 30; fi
fi</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_task_declarations">2.13. Task Declarations</h3>
<div class="paragraph">
<p>This step is probably the most complicated and most important step in the load process.
First, the declarations of tasks are loaded, either from cache or from source (lines 1-8).
Errors here can point to a bug in the framework, a problem in the application, or a problem with a task declaration itself.
Next, the loaded tasks are processed (line 9-11).
This function will take the loaded tasks and test or validate all parameters and dependencies they require.
This process can take some time, especially for testing external dependencies.
Errors tend to indicate configuration or dependency problems, not internal or declaration problems.</p>
</div>
<div class="paragraph">
<p>Some tasks might declare requirements as <em>optional</em>.
Those dependencies only throw warnings in a normal application run.
Only if an application is run in <em>strict</em> mode will those problems throw errors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td>
  <td class="code"><pre>if [[ -f ${CONFIG_MAP[&quot;CACHE_DIR&quot;]}/task-decl.map ]]; then
    ConsoleInfo &quot;--&gt;&quot; &quot;declaring tasks from cache&quot;
    source ${CONFIG_MAP[&quot;CACHE_DIR&quot;]}/task-decl.map
else
    ConsoleInfo &quot;--&gt;&quot; &quot;declaring tasks from source&quot;
    DeclareTasks
    if ConsoleHasErrors; then printf &quot;\n&quot;; exit 31; fi
fi
source $FW_HOME/bin/loader/init/process-tasks.sh
ProcessTasks
if ConsoleHasErrors; then printf &quot;\n&quot;; exit 32; fi</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scenario_declarations">2.14. Scenario Declarations</h3>
<div class="paragraph">
<p>When tasks are declared, the loader can declare all scenarios from the framework and application home as well as the optional scenario path.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
</pre></td>
  <td class="code"><pre>ConsoleInfo &quot;--&gt;&quot; &quot;declaring scenarios from source&quot;
DeclareScenarios
if ConsoleHasErrors; then printf &quot;\n&quot;; exit 33; fi
source $FW_HOME/bin/loader/init/process-scenarios.sh
ProcessScenarios
if ConsoleHasErrors; then printf &quot;\n&quot;; exit 34; fi</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_set_levels">2.15. Set Levels</h3>
<div class="paragraph">
<p>The next step is to set the correct levels (log levels) for the loader (the remaining load steps), the shell, and the tasks.
This is done for each level type in separation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td>
  <td class="code"><pre>case &quot;${CONFIG_MAP[&quot;LOADER_LEVEL&quot;]}&quot; in
    off | all | fatal | error | warn-strict | warn | info | debug | trace)
        ;;
    *)
        ConsoleError &quot;--&gt;&quot; &quot;unknown loader-level: ${CONFIG_MAP[&quot;LOADER_LEVEL&quot;]}&quot;
        printf &quot;    use: off, all, fatal, error, warn-strict, warn, info, debug, trace\n\n&quot;
        exit 35
        ;;
esac
case &quot;${CONFIG_MAP[&quot;SHELL_LEVEL&quot;]}&quot; in
    off | all | fatal | error | warn-strict | warn | info | debug | trace)
        ;;
    *)
        ConsoleError &quot;--&gt;&quot; &quot;unknown shell-level: ${CONFIG_MAP[&quot;SHELL_LEVEL&quot;]}&quot;
        printf &quot;    use: off, all, fatal, error, warn-strict, warn, info, debug, trace\n\n&quot;
        exit 36
        ;;
esac
case &quot;${CONFIG_MAP[&quot;TASK_LEVEL&quot;]}&quot; in
    off | all | fatal | error | warn-strict | warn | info | debug | trace)
        ;;
    *)
        ConsoleError &quot;--&gt;&quot; &quot;unknown task-level: ${CONFIG_MAP[&quot;TASK_LEVEL&quot;]}&quot;
        printf &quot;    use: off, all, fatal, error, warn-strict, warn, info, debug, trace\n\n&quot;
        exit 37
        ;;
esac</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_do_exit_options">2.16. Do (Exit) Options</h3>
<div class="paragraph">
<p>At this stage, the loader can process most the remaining exit options.
Those are command line options that request some behavior and then should cause the loader to exit.</p>
</div>
<div class="paragraph">
<p>If such options are requested, the loader might provide some information about its execution time (lines 5-11).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td>
  <td class="code"><pre>source $FW_HOME/bin/loader/init/do-options.sh
DoOptions
if ConsoleHasErrors; then printf &quot;\n&quot;; exit 38; fi

if [[ $DO_EXIT == true ]]; then
    _te=$(date +%s.%N)
    _exec_time=$_te-$_ts
    ConsoleInfo &quot;--&gt;&quot; &quot;execution time: $(echo $_exec_time | bc -l) sec&quot;
    ConsoleInfo &quot;--&gt;&quot; &quot;done&quot;
    exit 0
fi</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_runtime_configuration_file">2.17. Create Runtime Configuration File</h3>
<div class="paragraph">
<p>Now, the loader needs to create the temporary runtime configuration file.
The remaining actions are either to run a execute a task, run a scenario, or execute the interactive shell.
All of these actions require the configuration to be available.
The configuration file is created in the already tested directory, usually located in <code>/tmp/</code>.
The name of the configuration files includes a time stamp of its creation and an arbitrary, random string.
<code>mktemp</code> is used to create the file name.
Since the name is unique, the same application can be executed many times simultaneously.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
</pre></td>
  <td class="code"><pre>CONFIG_MAP[&quot;FW_L1_CONFIG&quot;]=$(mktemp &quot;$TMP_DIRECTORY/$(date +&quot;%H-%M-%S&quot;)-${CONFIG_MAP[&quot;APP_MODE&quot;]}-XXX&quot;)
export FW_L1_CONFIG=${CONFIG_MAP[&quot;FW_L1_CONFIG&quot;]}
WriteRuntimeConfig</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_execute_task_or_scenario">2.18. Execute Task or Scenario</h3>
<div class="paragraph">
<p>The final exit options are to execute a task or to run a scenario.
The loader will try either of them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td>
  <td class="code"><pre>__errno=0
if [[ &quot;${OPT_CLI_MAP[&quot;execute-task&quot;]}&quot; != false ]]; then
    echo ${OPT_CLI_MAP[&quot;execute-task&quot;]} | $FW_HOME/bin/shell/shell.sh
    __et=$?
    __errno=$((__errno + __et))
fi
if [[ &quot;${OPT_CLI_MAP[&quot;run-scenario&quot;]}&quot; != false ]]; then
    echo &quot;execute-scenario ${OPT_CLI_MAP[&quot;run-scenario&quot;]}&quot; | $FW_HOME/bin/shell/shell.sh
    __et=$?
    __errno=$((__errno + __et))
    DO_EXIT_2=true
fi</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_start_shell">2.19. Start Shell</h3>
<div class="paragraph">
<p>This is the final step of the load process.
If no task or scenario was requested to be executed, the loader will start the interactive shell.
This shell will run until a user caused it or exit, or until an error terminated the whole application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>if [[ ${DO_EXIT_2} == false ]]; then
    $FW_HOME/bin/shell/shell.sh
    __errno=$?
fi</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_clean_up">2.20. Clean Up</h3>
<div class="paragraph">
<p>Finally, the loader can cleanup and prepare to terminate.
Cleanup basically means to remove the temporary configuration file.
If the temporary directory is no longer needed, i.e. no other configuration exists in it, it can be removed as well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
</pre></td>
  <td class="code"><pre>if [[ -f $FW_L1_CONFIG ]]; then
    rm $FW_L1_CONFIG &gt;&amp; /dev/null
fi
if [[ -d $TMP_DIRECTORY &amp;&amp; $(ls $TMP_DIRECTORY | wc -l) == 0 ]]; then
    rmdir $TMP_DIRECTORY
fi</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_done">2.21. Done</h3>
<div class="paragraph">
<p>The loader is done, all actions have been taken.
It now can safely exit and return the execution to the <code>skb-framework</code> or the calling application.
A final message is displayed to mark this point in the process.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
</pre></td>
  <td class="code"><pre>ConsoleMessage &quot;\n\nhave a nice day\n\n\n&quot;
exit $__errno</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_shell">3. The Shell</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The loader is the script <code>$FW_HOME/bin/shell/shell.sh</code>.
It provides an interactive shell to either execute shell commands or tasks.
Most shell commands are realized by tasks, so the actual shell implementation is rather simple.</p>
</div>
<div class="paragraph">
<p>The initial settings are shown in the source block below.
Line 1 restricts <em>bash</em>, providing a safer execution environment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>set -o errexit -o pipefail -o noclobber -o nounset</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_test_parent_and_and_load_configuration">3.1. Test Parent and and load Configuration</h3>
<div class="paragraph">
<p>The shell then tests if it is run from the right parent (i.e. the loader) and it loads the temporary configuration.
The parent test is rather simple: if <code>FW_HOME</code> or <code>FW_L1_CONFIG</code> are not set, it is very likely that the shell has not been started by the loader.
Otherwise, the temporary configuration can be loaded (line 5).
The configuration is set for <em>running in the shell</em> (line 6).
This information is used by the API functions in the console to determine what output (log) level and what error/warning counters to use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
</pre></td>
  <td class="code"><pre>if [[ -z ${FW_HOME:-} || -z ${FW_L1_CONFIG-} ]]; then
    printf &quot; ==&gt; please run from framework or application\n\n&quot;
    exit 40
fi
source $FW_L1_CONFIG
CONFIG_MAP[&quot;RUNNING_IN&quot;]=&quot;shell&quot;</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_include">3.2. Include</h3>
<div class="paragraph">
<p>Next, the shell includes the framework&#8217;s API functions (lines 1-2) and the functions to maintain its command history (line 3).
Then the error and warning counters are reset (set to <em>0</em>), and a simple new line is printed (if messages are allowed).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
</pre></td>
  <td class="code"><pre>source $FW_HOME/bin/api/_include
source $FW_HOME/bin/api/describe/task.sh
source $FW_HOME/bin/shell/history.sh

ConsoleResetErrors
ConsoleResetWarnings
ConsoleMessage &quot;\n&quot;</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_settings">3.3. Settings</h3>
<div class="paragraph">
<p>Now the shell realizes its core settings.
These settings are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>SCMD</em> - used to store shell input</p>
</li>
<li>
<p><em>SARG</em> - used to store arguments (only used for history now)</p>
</li>
<li>
<p><em>STIME</em> - used to set the time when a command was entered, and later for time calculations</p>
</li>
<li>
<p><em>RELOAD_CFG</em> - a flag to indicate if the temporary configuration should be reloaded.
This flag is required for instance when the task <code>set</code> alters settings.</p>
</li>
<li>
<p><em>HISTORY</em> - a map with the history of commands
#end::settings[]</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
</pre></td>
  <td class="code"><pre>SCMD=                           # a shell-command from input
SARG=                           # argument(s), if any, for a shell command
STIME=                          # time a command was entered
RELOAD_CFG=false                # flag to reload configuration, e.g. after a change of settings
declare -A HISTORY              # the shell's history of executed commands
HISTORY[-1]=&quot;help&quot;              # dummy first entry, size calculation doesn't seem to work otherwise</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_inner_loop_fwinterpreter">3.4. Inner Loop: FWInterpreter</h3>
<div class="paragraph">
<p>The inner loop is an interpreter for all input the shell wants to add to its history.
This input might be the request to execute a task, or a command that the shell realizes using a task, or a simple command.
The inner loop is defined as a function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre>FWInterpreter() {
    case &quot;$SCMD&quot; in
        # ...
    esac
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside this function, the inner loop, the shell tests first for all input that it can associate to a command.
If none of these tests is satisfied, it assumes that the input is actually a task to be executed with parameters.</p>
</div>
<div class="sect3">
<h4 id="_execute_a_scenario">3.4.1. Execute a Scenario</h4>
<div class="paragraph">
<p>The first command tested is to execute a scenario.
This command starts with either <code>execute-scenario</code> or <code>es</code>.
No argument means error.
Some argument means the name of a scenario.
In this case, execute the scenario and put the command into the history.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>        execute-scenario | es)
            printf &quot;\n    execute-scenario/rs requires a scenario as argument\n\n&quot;
            ;;
        &quot;execute-scenario &quot;*)
            SARG=${SCMD#*execute-scenario }
            ExecuteScenario $SARG
            ShellAddCmdHistory
            ;;
        &quot;es &quot;*)
            SARG=${SCMD#*es }
            ExecuteScenario $SARG
            ShellAddCmdHistory
            ;;</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_clear_screen">3.4.2. Clear Screen</h4>
<div class="paragraph">
<p>This a simple command without arguments.
The clear screen functionality is realized by printing the ANSI escape sequence for clear screen.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>        clear-screen | &quot;clear-screen &quot;* | cls | &quot;cls &quot;*)
            printf &quot;\033c&quot;
            ShellAddCmdHistory
            ;;</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_time">3.4.3. Time</h4>
<div class="paragraph">
<p>Print the current time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>        time | &quot;time &quot;* | T | &quot;T &quot;*)
            printf &quot;\n    %s\n\n&quot; &quot;$STIME&quot;
            ShellAddCmdHistory
            ;;</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_print_configuration">3.4.4. Print Configuration</h4>
<div class="paragraph">
<p>Execute the task <code>list-configuration</code> with default settings, which displays a list with the current configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>        configuration | &quot;configuration &quot;* | c | &quot;c &quot;*)
            ${DMAP_TASK_EXEC[&quot;list-configuration&quot;]}
            ShellAddCmdHistory
            ;;</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_print_statistics">3.4.5. Print Statistics</h4>
<div class="paragraph">
<p>Execute the task <code>statistics</code> with default settings, which displays an overview of statistic information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>        statistic | &quot;statistic &quot;* | s | &quot;s &quot;*)
            ${DMAP_TASK_EXEC[&quot;statistics&quot;]}
            ShellAddCmdHistory
            ;;</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_list_tasks">3.4.6. List Tasks</h4>
<div class="paragraph">
<p>Execute the task <code>list-tasks</code> with default settings, which displays an list of loaded tasks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>        tasks | &quot;tasks &quot;* | t | &quot;t &quot;*)
            ${DMAP_TASK_EXEC[&quot;list-tasks&quot;]}
            ShellAddCmdHistory
            ;;</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_list_application_tasks">3.4.7. List Application Tasks</h4>
<div class="paragraph">
<p>Execute the task <code>list-tasks</code> with setting <code>--origin app</code>, which displays an list of loaded tasks with origin application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>        tasks-application | &quot;tasks-application &quot;* | ta | &quot;ta &quot;*)
            ${DMAP_TASK_EXEC[&quot;list-tasks&quot;]} --origin app
            ShellAddCmdHistory
            ;;</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_comments">3.4.8. Comments</h4>
<div class="paragraph">
<p>Do nothing if the input starts with the comment character <code>#</code> in any variation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
</pre></td>
  <td class="code"><pre>        &quot;&quot; | &quot;#&quot; | &quot;#&quot;* | &quot;# &quot;*)
            ;;</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_all_other_input">3.4.9. All other Input</h4>
<div class="paragraph">
<p>All other input is interpreted as the request to execute a task with optional arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td>
  <td class="code"><pre>        *)
            SARG=&quot;$SCMD&quot;
            ExecuteTask &quot;$SARG&quot;
            ShellAddCmdHistory

            case &quot;$SCMD&quot; in
                &quot;set &quot;* | &quot;setting &quot;*) RELOAD_CFG=true;;
            esac
            ;;</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_outer_loop_fwshell">3.5. Outer Loop: FWShell</h3>
<div class="paragraph">
<p>The outer loop is the shell&#8217;s main loop reading input from standard input and interpreting it.
While input is read (a line finished with an enter), the line is read into the variable <code>SCMD</code> and a time stamp is written into <code>STIME</code>.
Then <code>SCMD</code> is evaluated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td>
  <td class="code"><pre>FWShell() {
    while read -a args; do
        SCMD=&quot;${args[@]:-}&quot; &lt;&amp;3
        STIME=$(date +&quot;%T&quot;)
        case &quot;$SCMD&quot; in
            # ...
        esac

        if [[ $RELOAD_CFG == true ]]; then
            source $FW_L1_CONFIG
            CONFIG_MAP[&quot;RUNNING_IN&quot;]=&quot;shell&quot;
            RELOAD_CFG=false
        fi
        if ConsoleIsPrompt; then ConsoleMessage &quot;${CONFIG_MAP[&quot;SHELL_PROMPT&quot;]}&quot;; fi
    done
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside this function, the outer loop, the shell tests first for shell commands.
If none of these tests is satisfied, it calls the inner loop to deal with the input.</p>
</div>
<div class="paragraph">
<p>Once finished with the input, the value of <code>RELOAD_CFG</code> to see if the configuration has to be reloaded.
Finally, a new prompt is displayed.</p>
</div>
<div class="sect3">
<h4 id="_help">3.5.1. Help</h4>
<div class="paragraph">
<p>If help is requested, display the command help file for the current print mode.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
</pre></td>
  <td class="code"><pre>            help | h | &quot;?&quot;)
                cat ${CONFIG_MAP[&quot;FW_HOME&quot;]}/etc/help/commands.${CONFIG_MAP[&quot;PRINT_MODE&quot;]}
                ;;</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_history">3.5.2. History</h4>
<div class="paragraph">
<p>History means to print the history or to run a commend stored in the history.
Both functionalities are provided by the history function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
</pre></td>
  <td class="code"><pre>            !*)
                SARG=${SCMD#*!}
                ShellCmdHistory
                ;;
            history*)
                SARG=${SCMD#*history}
                ShellCmdHistory
                ;;</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_exit">3.5.3. Exit</h4>
<div class="paragraph">
<p>If exit is requested, the shell leaves the outer loop.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
</pre></td>
  <td class="code"><pre>            exit | quit | q | bye)
                break
                ;;</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_all_other_input_2">3.5.4. All other Input</h4>
<div class="paragraph">
<p>All other input is forwarded to the inner loop for further evaluation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
</pre></td>
  <td class="code"><pre>            *)
                FWInterpreter
                ;;</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_the_shell">3.6. Run the Shell</h3>
<div class="paragraph">
<p>The final lines run the actual shell.
First, input is redirected to <code>#3</code> while the shell is running (line 1).
This allows to read lines from the standard input into the shell.
Next, the first prompt is displayed (line 2).
Then the outer loop is called (line 3).
When the outer loop is finished, the redirection is reverted (line 4).
Now the shell is finished and the process returns to the loader.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>exec 3&lt;/dev/tty || exec 3&lt;&amp;0
if ConsoleIsPrompt; then ConsoleMessage &quot;${CONFIG_MAP[&quot;SHELL_PROMPT&quot;]}&quot;; fi
FWShell
exec 3&lt;&amp;-</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-11-15 11:14:23 GMT
</div>
</div>
</body>
</html>